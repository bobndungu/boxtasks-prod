# Nginx cache headers for BoxTasks frontend
# Include this in your nginx server block for the frontend

# CRITICAL: version.json must never be cached
# This is used to detect new deployments
location = /version.json {
    add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate";
    add_header Pragma "no-cache";
    add_header Expires "0";
    etag off;
    if_modified_since off;
}

# index.html should not be cached (SPA entry point)
location = /index.html {
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    add_header Pragma "no-cache";
}

# Hashed assets (JS/CSS with content hash in filename) - cache long term
# Vite generates filenames like: index-abc123.js
location ~* \.[a-f0-9]{8,}\.(js|css)$ {
    add_header Cache-Control "public, max-age=31536000, immutable";
}

# Other static assets - moderate caching
location ~* \.(png|jpg|jpeg|gif|ico|svg|webp|woff|woff2|ttf|eot)$ {
    add_header Cache-Control "public, max-age=2592000";  # 30 days
}

# Service worker - should not be cached
location = /sw.js {
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    add_header Pragma "no-cache";
}

# Workbox files - should not be cached
location ~* workbox.*\.js$ {
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    add_header Pragma "no-cache";
}
