services:
  boxtasks_security.rate_limiter:
    class: Drupal\boxtasks_security\Service\RateLimiter
    arguments: ['@flood', '@current_user', '@config.factory']

  boxtasks_security.rate_limit_subscriber:
    class: Drupal\boxtasks_security\EventSubscriber\RateLimitSubscriber
    arguments: ['@boxtasks_security.rate_limiter', '@boxtasks_security.audit_logger']
    tags:
      - { name: event_subscriber }

  boxtasks_security.input_sanitizer:
    class: Drupal\boxtasks_security\Service\InputSanitizer

  boxtasks_security.input_validation_subscriber:
    class: Drupal\boxtasks_security\EventSubscriber\InputValidationSubscriber
    arguments: ['@boxtasks_security.input_sanitizer', '@logger.factory', '@boxtasks_security.audit_logger']
    tags:
      - { name: event_subscriber }

  boxtasks_security.audit_logger:
    class: Drupal\boxtasks_security\Service\AuditLogger
    arguments: ['@database', '@current_user', '@datetime.time']
    calls:
      - [setRequestStack, ['@request_stack']]

  boxtasks_security.oauth_authentication_subscriber:
    class: Drupal\boxtasks_security\EventSubscriber\OAuthAuthenticationSubscriber
    arguments:
      - '@current_user'
      - '@simple_oauth.server.resource_server.factory'
      - '@entity_type.manager'
      - '@psr7.http_message_factory'
      - '@psr7.http_foundation_factory'
    tags:
      - { name: event_subscriber }
